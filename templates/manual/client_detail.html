{% extends "base.html" %} {% block content %}

<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<nav style="margin-bottom: 20px; font-size: 14px; color: var(--gold)">
  <a
    href="{{ url_for('home.index') }}"
    style="color: inherit; text-decoration: none; opacity: 0.7"
    >Home</a
  >
  <span style="opacity: 0.5"> / </span>
  <a
    href="{{ url_for('manual.index') }}"
    style="color: inherit; text-decoration: none; opacity: 0.7"
    >Clientes</a
  >
  <span style="opacity: 0.5"> / </span>
  <span style="font-weight: bold">Manual: {{ client.razao_social }}</span>
</nav>

<div style="display: flex; gap: 20px; align-items: flex-start">
  <aside style="width: 200px; position: sticky; top: 20px">
    <div class="card" style="padding: 10px">
      <h4 style="margin: 0 0 10px 0; color: var(--gold)">NavegaÃ§Ã£o</h4>
      <a
        href="{{ url_for('manual.index') }}"
        style="display: block; font-size: 13px; margin-bottom: 10px"
        >â† Voltar Ã  Lista</a
      >
      <button
        class="btn-primary"
        onclick="salvarManual()"
        style="width: 100%; font-size: 13px"
      >
        ğŸ’¾ Salvar Tudo
      </button>
    </div>
  </aside>

  <main style="flex: 1">
    <div class="card wide">
      <h2 style="margin: 0">{{ client.razao_social }}</h2>
      <p class="muted" style="margin-bottom: 20px">
        Utilize este espaÃ§o para contatos, logins e o passo a passo com GIFs.
      </p>

      <div
        id="editor-container"
        style="
          background: white;
          color: black;
          min-height: 600px;
          border-radius: 8px;
        "
      >
        {{ client.manual_content | safe if client.manual_content else '' }}
      </div>
    </div>
  </main>
</div>

<script>
  // InicializaÃ§Ã£o do Editor
  var quill = new Quill("#editor-container", {
    theme: "snow",
    placeholder: "Cole prints e GIFs aqui...",
    modules: {
      toolbar: [
        [{ header: [1, 2, 3, false] }],
        ["bold", "italic", "underline"],
        [{ list: "ordered" }, { list: "bullet" }],
        ["link", "image"],
        ["clean"],
      ],
    },
  });

  // FunÃ§Ã£o que envia para a rota que vocÃª jÃ¡ tem no manual.py
  function salvarManual() {
    const html = quill.root.innerHTML;
    fetch(`/manual/save_manual/{{ client.id }}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ content: html }),
    })
      .then((res) => res.json())
      .then((data) => {
        alert("âœ… Manual salvo com sucesso!");
      })
      .catch((err) => alert("âŒ Erro ao salvar no servidor"));
  }
</script>
{% endblock %}
